<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UAP/UFO/NHI Chronology Timeline | Disclosure Database</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Interactive timeline visualization of UAP/UFO sightings, NHI encounters, and Earth's communication attempts with non-human intelligence">
    <meta name="keywords" content="UAP timeline, NHI communication, Arecibo message, crop circles, interstellar messages">
    
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Share Tech Mono', 'Courier New', monospace;
            background: #0d1117;
            color: #c9d1d9;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 100%;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 30px 20px;
            background: linear-gradient(180deg, #161b22 0%, #0d1117 100%);
            border-bottom: 1px solid #30363d;
        }
        
        h1 {
            color: #58a6ff;
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #8b949e;
            font-size: 0.9em;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 20px;
            flex-wrap: wrap;
        }
        
        .tabs {
            display: flex;
            gap: 5px;
            padding: 10px 20px;
            background: #161b22;
            border-bottom: 1px solid #30363d;
            overflow-x: auto;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .tab {
            background: #21262d;
            border: 1px solid #30363d;
            color: #8b949e;
            padding: 10px 20px;
            cursor: pointer;
            font-family: 'Share Tech Mono', monospace;
            transition: all 0.2s ease;
            border-radius: 6px;
            font-size: 0.85em;
            white-space: nowrap;
        }
        
        .tab:hover {
            background: #30363d;
            border-color: #58a6ff;
            color: #58a6ff;
        }
        
        .tab.active {
            background: #1f6feb;
            border-color: #1f6feb;
            color: #ffffff;
        }
        
        .btn {
            background: #21262d;
            border: 1px solid #30363d;
            color: #8b949e;
            padding: 8px 16px;
            cursor: pointer;
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.85em;
            border-radius: 6px;
            transition: all 0.2s;
        }
        
        .btn:hover {
            background: #30363d;
            border-color: #58a6ff;
            color: #58a6ff;
        }
        
        .btn.active {
            background: #1f6feb;
            border-color: #1f6feb;
            color: #ffffff;
        }
        
        #timeline {
            width: 100%;
            height: 600px;
            background: #0d1117;
            position: relative;
        }
        
        .timeline-axis {
            stroke: #30363d;
            stroke-width: 2;
        }
        
        .timeline-track {
            stroke: #21262d;
            stroke-width: 1;
            fill: none;
        }
        
        .event-node {
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .event-node.outbound {
            fill: #58a6ff;
            stroke: #1f6feb;
            stroke-width: 2;
        }
        
        .event-node.inbound {
            fill: #f85149;
            stroke: #da3633;
            stroke-width: 2;
        }
        
        .event-node.chronology {
            fill: #8b949e;
            stroke: #6e7681;
            stroke-width: 1;
            r: 3;
        }
        
        .event-node:hover {
            r: 10;
            filter: brightness(1.3);
        }
        
        .event-label {
            font-size: 11px;
            fill: #8b949e;
            pointer-events: none;
        }
        
        .tooltip {
            position: absolute;
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            max-width: 300px;
            z-index: 1000;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
        }
        
        .tooltip.visible {
            opacity: 1;
        }
        
        .tooltip-title {
            color: #58a6ff;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .tooltip-date {
            color: #8b949e;
            font-size: 0.85em;
            margin-bottom: 8px;
        }
        
        .tooltip-description {
            color: #c9d1d9;
            font-size: 0.85em;
            line-height: 1.4;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            padding: 20px;
            font-size: 0.9em;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .legend-dot.outbound {
            background: #58a6ff;
        }
        
        .legend-dot.inbound {
            background: #f85149;
        }
        
        input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
            accent-color: #1f6feb;
        }
        
        .back-link {
            text-align: center;
            padding: 20px;
        }
        
        .back-link a {
            color: #58a6ff;
            text-decoration: none;
            font-size: 0.9em;
        }
        
        .back-link a:hover {
            text-decoration: underline;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 1.5em;
            }
            
            #timeline {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>UAP/UFO/NHI DISCLOSURE DATABASE</h1>
            <div class="subtitle">Interactive Timeline Visualization</div>
        </header>
        
        <div class="tabs" style="display: flex; justify-content: center; gap: 10px; padding: 20px; flex-wrap: wrap; background: #161b22; border-bottom: 1px solid #30363d;">
            <div class="tab" onclick="window.location.href='viewer.html'">INDEX</div>
            <div class="tab" onclick="window.location.href='viewer.html#chronology'">CHRONOLOGY</div>
            <div class="tab" onclick="window.location.href='viewer.html#contact'">REQUEST NHI CONTACT</div>
            <div class="tab" onclick="window.location.href='viewer.html#outbound'">OUTBOUND</div>
            <div class="tab" onclick="window.location.href='viewer.html#inbound'">INBOUND</div>
            <div class="tab" onclick="window.location.href='viewer.html#arecibo'">ARECIBO 1974</div>
            <div class="tab active">TIMELINE VIZ</div>
        </div>
        
        <div style="text-align: center; padding: 20px; background: #0d1117;">
            <h2 style="color: #58a6ff; margin-bottom: 10px;">UAP/UFO/NHI CHRONOLOGY TIMELINE</h2>
            <div style="color: #8b949e; font-size: 0.9em;">Interactive visualization of sightings, encounters, communications, and disclosure events</div>
        </div>
        
        <div class="controls">
            <button class="btn active" onclick="showAll()">ALL EVENTS</button>
            <button class="btn" onclick="showOutbound()">OUTBOUND ONLY</button>
            <button class="btn" onclick="showInbound()">INBOUND ONLY</button>
            <button class="btn" onclick="showChronology()">CHRONOLOGY</button>
            <button class="btn" onclick="resetZoom()">RESET ZOOM</button>
        </div>
        
        <div style="text-align: center; padding: 10px; color: #8b949e; font-size: 0.85em;">
            <span id="eventCount">Loading events...</span>
        </div>
        
        <div class="filter-panel" style="background: #161b22; border: 1px solid #30363d; border-radius: 6px; padding: 20px; margin: 20px auto; max-width: 1000px;">
            <div style="color: #58a6ff; font-weight: 600; margin-bottom: 15px; text-align: center;">CHRONOLOGY TIME PERIOD FILTERS</div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 8px; font-size: 0.9em;">
                <label style="display: flex; align-items: center; gap: 6px; color: #c9d1d9; cursor: pointer;">
                    <input type="checkbox" class="period-filter" value="2030" checked onchange="applyPeriodFilters()">
                    <span>2030</span>
                </label>
                <label style="display: flex; align-items: center; gap: 6px; color: #c9d1d9; cursor: pointer;">
                    <input type="checkbox" class="period-filter" value="2029" checked onchange="applyPeriodFilters()">
                    <span>2029</span>
                </label>
                <label style="display: flex; align-items: center; gap: 6px; color: #c9d1d9; cursor: pointer;">
                    <input type="checkbox" class="period-filter" value="2028" checked onchange="applyPeriodFilters()">
                    <span>2028</span>
                </label>
                <label style="display: flex; align-items: center; gap: 6px; color: #c9d1d9; cursor: pointer;">
                    <input type="checkbox" class="period-filter" value="2027" checked onchange="applyPeriodFilters()">
                    <span>2027</span>
                </label>
                <label style="display: flex; align-items: center; gap: 6px; color: #c9d1d9; cursor: pointer;">
                    <input type="checkbox" class="period-filter" value="2026" checked onchange="applyPeriodFilters()">
                    <span>2026</span>
                </label>
                <label style="display: flex; align-items: center; gap: 6px; color: #c9d1d9; cursor: pointer;">
                    <input type="checkbox" class="period-filter" value="2025" checked onchange="applyPeriodFilters()">
                    <span>2025</span>
                </label>
                <label style="display: flex; align-items: center; gap: 6px; color: #c9d1d9; cursor: pointer;">
                    <input type="checkbox" class="period-filter" value="2024" checked onchange="applyPeriodFilters()">
                    <span>2024</span>
                </label>
                <label style="display: flex; align-items: center; gap: 6px; color: #c9d1d9; cursor: pointer;">
                    <input type="checkbox" class="period-filter" value="2023" checked onchange="applyPeriodFilters()">
                    <span>2023</span>
                </label>
                <label style="display: flex; align-items: center; gap: 6px; color: #c9d1d9; cursor: pointer;">
                    <input type="checkbox" class="period-filter" value="2022" checked onchange="applyPeriodFilters()">
                    <span>2022</span>
                </label>
                <label style="display: flex; align-items: center; gap: 6px; color: #c9d1d9; cursor: pointer;">
                    <input type="checkbox" class="period-filter" value="2021" checked onchange="applyPeriodFilters()">
                    <span>2021</span>
                </label>
                <label style="display: flex; align-items: center; gap: 6px; color: #c9d1d9; cursor: pointer;">
                    <input type="checkbox" class="period-filter" value="2020" checked onchange="applyPeriodFilters()">
                    <span>2020</span>
                </label>
                <label style="display: flex; align-items: center; gap: 6px; color: #c9d1d9; cursor: pointer;">
                    <input type="checkbox" class="period-filter" value="2019" checked onchange="applyPeriodFilters()">
                    <span>2019</span>
                </label>
                <label style="display: flex; align-items: center; gap: 6px; color: #c9d1d9; cursor: pointer;">
                    <input type="checkbox" class="period-filter" value="2018" checked onchange="applyPeriodFilters()">
                    <span>2018</span>
                </label>
                <label style="display: flex; align-items: center; gap: 6px; color: #c9d1d9; cursor: pointer;">
                    <input type="checkbox" class="period-filter" value="2017" checked onchange="applyPeriodFilters()">
                    <span>2017</span>
                </label>
                <label style="display: flex; align-items: center; gap: 6px; color: #c9d1d9; cursor: pointer;">
                    <input type="checkbox" class="period-filter" value="2016" checked onchange="applyPeriodFilters()">
                    <span>2016</span>
                </label>
                <label style="display: flex; align-items: center; gap: 6px; color: #c9d1d9; cursor: pointer;">
                    <input type="checkbox" class="period-filter" value="2015" checked onchange="applyPeriodFilters()">
                    <span>2015</span>
                </label>
                <label style="display: flex; align-items: center; gap: 6px; color: #c9d1d9; cursor: pointer;">
                    <input type="checkbox" class="period-filter" value="2014" checked onchange="applyPeriodFilters()">
                    <span>2014</span>
                </label>
                <label style="display: flex; align-items: center; gap: 6px; color: #c9d1d9; cursor: pointer;">
                    <input type="checkbox" class="period-filter" value="2013" checked onchange="applyPeriodFilters()">
                    <span>2013</span>
                </label>
                <label style="display: flex; align-items: center; gap: 6px; color: #c9d1d9; cursor: pointer;">
                    <input type="checkbox" class="period-filter" value="2012" checked onchange="applyPeriodFilters()">
                    <span>2012</span>
                </label>
                <label style="display: flex; align-items: center; gap: 6px; color: #c9d1d9; cursor: pointer;">
                    <input type="checkbox" class="period-filter" value="2011" checked onchange="applyPeriodFilters()">
                    <span>2011</span>
                </label>
                <label style="display: flex; align-items: center; gap: 6px; color: #c9d1d9; cursor: pointer;">
                    <input type="checkbox" class="period-filter" value="2010" checked onchange="applyPeriodFilters()">
                    <span>2010</span>
                </label>
                <label style="display: flex; align-items: center; gap: 6px; color: #c9d1d9; cursor: pointer;">
                    <input type="checkbox" class="period-filter" value="200" checked onchange="applyPeriodFilters()">
                    <span>2000s</span>
                </label>
                <label style="display: flex; align-items: center; gap: 6px; color: #c9d1d9; cursor: pointer;">
                    <input type="checkbox" class="period-filter" value="199" checked onchange="applyPeriodFilters()">
                    <span>1990s</span>
                </label>
                <label style="display: flex; align-items: center; gap: 6px; color: #c9d1d9; cursor: pointer;">
                    <input type="checkbox" class="period-filter" value="198" checked onchange="applyPeriodFilters()">
                    <span>1980s</span>
                </label>
                <label style="display: flex; align-items: center; gap: 6px; color: #c9d1d9; cursor: pointer;">
                    <input type="checkbox" class="period-filter" value="197" checked onchange="applyPeriodFilters()">
                    <span>1970s</span>
                </label>
                <label style="display: flex; align-items: center; gap: 6px; color: #c9d1d9; cursor: pointer;">
                    <input type="checkbox" class="period-filter" value="196" checked onchange="applyPeriodFilters()">
                    <span>1960s</span>
                </label>
                <label style="display: flex; align-items: center; gap: 6px; color: #c9d1d9; cursor: pointer;">
                    <input type="checkbox" class="period-filter" value="195" checked onchange="applyPeriodFilters()">
                    <span>1950s</span>
                </label>
                <label style="display: flex; align-items: center; gap: 6px; color: #c9d1d9; cursor: pointer;">
                    <input type="checkbox" class="period-filter" value="194" checked onchange="applyPeriodFilters()">
                    <span>1940s</span>
                </label>
                <label style="display: flex; align-items: center; gap: 6px; color: #c9d1d9; cursor: pointer;">
                    <input type="checkbox" class="period-filter" value="18" onchange="applyPeriodFilters()">
                    <span>1800s</span>
                </label>
                <label style="display: flex; align-items: center; gap: 6px; color: #c9d1d9; cursor: pointer;">
                    <input type="checkbox" class="period-filter" value="ancient" onchange="applyPeriodFilters()">
                    <span>ANCIENT</span>
                </label>
            </div>
            <div style="display: flex; justify-content: center; gap: 10px; margin-top: 15px;">
                <button class="btn" onclick="selectAllPeriods()">SELECT ALL</button>
                <button class="btn" onclick="deselectAllPeriods()">DESELECT ALL</button>
            </div>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-dot outbound"></div>
                <span>Outbound (Earth → Space)</span>
            </div>
            <div class="legend-item">
                <div class="legend-dot inbound"></div>
                <span>Inbound (Space → Earth)</span>
            </div>
        </div>
        
        <div id="timeline"></div>
        
        <div class="back-link">
            <a href="viewer.html">← Back to Main Viewer</a>
        </div>
    </div>
    
    <div class="tooltip" id="tooltip">
        <div class="tooltip-title"></div>
        <div class="tooltip-date"></div>
        <div class="tooltip-description"></div>
    </div>
    
    <script>
        // All events (will be populated from chronology + communication events)
        let allEvents = [];
        
        // Communication events data
        const communicationEvents = [
            // Outbound Communications
            {
                date: new Date(1972, 2, 2),
                type: 'outbound',
                title: 'Pioneer 10 Plaque',
                description: 'First physical message from humanity. Gold-anodized aluminum plaque with human figures and Earth\'s location.'
            },
            {
                date: new Date(1973, 2, 3),
                type: 'outbound',
                title: 'Pioneer 11 Plaque',
                description: 'Identical plaque to Pioneer 10, continuing humanity\'s first physical messages to space.'
            },
            {
                date: new Date(1974, 10, 16),
                type: 'outbound',
                title: 'Arecibo Message',
                description: 'First deliberate interstellar radio message. 1,679-bit signal sent to M13 cluster 25,000 light years away.'
            },
            {
                date: new Date(1977, 7, 20),
                type: 'outbound',
                title: 'Voyager Golden Records',
                description: '12-inch gold-plated records with 116 images, greetings in 55 languages, and 90 minutes of music.'
            },
            {
                date: new Date(1999, 4, 24),
                type: 'outbound',
                title: 'Cosmic Call',
                description: 'Radio message using sophisticated "Lexicon" mathematical language toward nearby stars.'
            },
            {
                date: new Date(2001, 8, 3),
                type: 'outbound',
                title: 'Teen Age Message',
                description: 'First interstellar message composed by teenagers, transmitted to six sun-like stars.'
            },
            {
                date: new Date(2003, 6, 6),
                type: 'outbound',
                title: 'Cosmic Call 2',
                description: 'Second Cosmic Call transmission to five additional stars.'
            },
            {
                date: new Date(2008, 7, 28),
                type: 'outbound',
                title: 'Hello from Earth',
                description: 'First crowdsourced message via Bebo. 501 messages from 195 countries to Gliese 581c.'
            },
            {
                date: new Date(2026, 0, 1),
                type: 'outbound',
                title: 'Request Direct NHI Communication',
                description: 'Public message requesting direct, transparent communication, bypassing government intermediaries.'
            },
            
            // Inbound Communications
            {
                date: new Date(1977, 7, 15),
                type: 'inbound',
                title: 'Wow! Signal',
                description: 'Strong 72-second narrowband radio signal from Sagittarius. Never detected again despite follow-ups.'
            },
            {
                date: new Date(2001, 7, 14),
                type: 'inbound',
                title: 'Chilbolton Face Formation',
                description: 'Crop formation showing humanoid face near Chilbolton radio telescope, Hampshire, UK.'
            },
            {
                date: new Date(2001, 7, 19),
                type: 'inbound',
                title: 'Chilbolton Arecibo Reply',
                description: 'Crop formation mirroring 1974 Arecibo message structure with different data: silicon-based DNA, different population.'
            },
            {
                date: new Date(2002, 7, 15),
                type: 'inbound',
                title: 'Crabwood Formation',
                description: 'Crop formation with alien face and binary message: "Beware the bearers of false gifts... Conduit closing."'
            }
        ];
        
        // Load chronology data
        async function loadChronology() {
            try {
                const response = await fetch('dist/chronology.md');
                const text = await response.text();
                parseChronologyEvents(text);
            } catch (error) {
                console.error('Error loading chronology:', error);
                allEvents = [...communicationEvents];
                initializeTimeline();
            }
        }
        
        function parseChronologyEvents(text) {
            const lines = text.split('\n');
            const chronologyEvents = [];
            
            for (let line of lines) {
                line = line.trim();
                
                // Match headers like "## 2025, September 9 - Title" or "## 70 CE - Title"
                const headerMatch = line.match(/^##\s+(\d{1,4}(?:\s+(?:BCE|CE))?(?:,\s+[A-Za-z]+(?:\s+\d{1,2})?)?)\s+-\s+(.+)/i);
                
                if (headerMatch) {
                    const dateStr = headerMatch[1];
                    const title = headerMatch[2];
                    
                    // Parse date
                    const date = parseDateString(dateStr);
                    if (date) {
                        chronologyEvents.push({
                            date: date,
                            type: 'chronology',
                            title: title,
                            description: `UAP/UFO event from chronology: ${title}`
                        });
                    }
                }
            }
            
            // Combine communication events and chronology events
            allEvents = [...communicationEvents, ...chronologyEvents];
            allEvents.sort((a, b) => a.date - b.date);
            
            // Debug: Log sample events
            console.log('Total events:', allEvents.length);
            console.log('Communication events:', communicationEvents.length);
            console.log('Chronology events:', chronologyEvents.length);
            console.log('Sample chronology events:', chronologyEvents.slice(0, 5));
            console.log('Date range:', {
                min: d3.min(allEvents.map(d => d.date)),
                max: d3.max(allEvents.map(d => d.date))
            });
            
            document.getElementById('eventCount').textContent = 
                `Showing ${allEvents.length} events (${communicationEvents.length} communications, ${chronologyEvents.length} chronology)`;
            
            initializeTimeline();
        }
        
        function parseDateString(dateStr) {
            // Handle BCE/CE dates - JavaScript Date doesn't support BCE, so use year 1 as baseline
            const bceMatch = dateStr.match(/^(\d+)\s+BCE/i);
            if (bceMatch) {
                const year = parseInt(bceMatch[1]);
                // Map BCE to early dates: 1000 BCE = year 1, 1 BCE = year 1000
                return new Date(1000 - year, 0, 1);
            }
            
            const ceMatch = dateStr.match(/^(\d+)\s+CE/i);
            if (ceMatch) {
                const year = parseInt(ceMatch[1]);
                // Map CE 1-1000 to years 1000-2000 to avoid overlap with modern dates
                if (year < 1000) {
                    return new Date(1000 + year, 0, 1);
                }
                return new Date(year, 0, 1);
            }
            
            // Handle modern dates like "2025, September 9"
            const modernMatch = dateStr.match(/^(\d{4})(?:,\s+([A-Za-z]+)(?:\s+(\d{1,2}))?)?/);
            if (modernMatch) {
                const year = parseInt(modernMatch[1]);
                const monthName = modernMatch[2];
                const day = modernMatch[3] ? parseInt(modernMatch[3]) : 1;
                
                if (monthName) {
                    const months = {
                        'january': 0, 'february': 1, 'march': 2, 'april': 3,
                        'may': 4, 'june': 5, 'july': 6, 'august': 7,
                        'september': 8, 'october': 9, 'november': 10, 'december': 11
                    };
                    const month = months[monthName.toLowerCase()];
                    if (month !== undefined) {
                        return new Date(year, month, day);
                    }
                }
                
                return new Date(year, 0, 1);
            }
            
            return null;
        }
        
        // Initialize on page load
        loadChronology();
        
        function initializeTimeline() {
            if (allEvents.length === 0) return;
            
            // Clear existing SVG
            d3.select('#timeline svg').remove();
            
            drawTimeline();
        }
        
        function drawTimeline() {
            // Timeline dimensions
            const margin = {top: 60, right: 40, bottom: 60, left: 40};
            const width = document.getElementById('timeline').clientWidth - margin.left - margin.right;
            const height = 600 - margin.top - margin.bottom;
            
            // Create SVG
            const svg = d3.select('#timeline')
                .append('svg')
                .attr('width', width + margin.left + margin.right)
                .attr('height', height + margin.top + margin.bottom)
                .append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);
            
            // Find date range from data with padding
            const dates = allEvents.map(d => d.date);
            const minDate = d3.min(dates);
            const maxDate = d3.max(dates);
            
            // Add padding to date range (5% on each side)
            const dateRange = maxDate - minDate;
            const paddedMin = new Date(minDate.getTime() - dateRange * 0.05);
            const paddedMax = new Date(maxDate.getTime() + dateRange * 0.05);
            
            // Scales
            const xScale = d3.scaleTime()
                .domain([paddedMin, paddedMax])
                .range([0, width]);
            
            const yOutbound = height * 0.3;
            const yInbound = height * 0.5;
            const yChronology = height * 0.7;
        
            // Axes with custom tick format for BCE/CE dates
            const xAxis = d3.axisBottom(xScale)
                .ticks(15)
                .tickFormat(d => {
                    const year = d.getFullYear();
                    // Convert back to BCE/CE for display
                    if (year < 1000) {
                        return `${1000 - year} BCE`;
                    } else if (year >= 1000 && year < 2000) {
                        return `${year - 1000} CE`;
                    }
                    return year.toString();
                });
        
        svg.append('g')
            .attr('class', 'x-axis')
            .attr('transform', `translate(0,${height / 2})`)
            .call(xAxis)
            .selectAll('text')
            .style('fill', '#8b949e')
            .style('font-family', 'Share Tech Mono');
        
        svg.selectAll('.x-axis path, .x-axis line')
            .style('stroke', '#30363d');
        
            // Timeline tracks
            svg.append('line')
                .attr('class', 'timeline-track')
                .attr('x1', 0)
                .attr('y1', yOutbound)
                .attr('x2', width)
                .attr('y2', yOutbound);
            
            svg.append('line')
                .attr('class', 'timeline-track')
                .attr('x1', 0)
                .attr('y1', yInbound)
                .attr('x2', width)
                .attr('y2', yInbound);
            
            svg.append('line')
                .attr('class', 'timeline-track')
                .attr('x1', 0)
                .attr('y1', yChronology)
                .attr('x2', width)
                .attr('y2', yChronology);
            
            // Track labels
            svg.append('text')
                .attr('x', -10)
                .attr('y', yOutbound)
                .attr('text-anchor', 'end')
                .attr('dominant-baseline', 'middle')
                .style('fill', '#58a6ff')
                .style('font-size', '11px')
                .text('OUTBOUND →');
            
            svg.append('text')
                .attr('x', -10)
                .attr('y', yInbound)
                .attr('text-anchor', 'end')
                .attr('dominant-baseline', 'middle')
                .style('fill', '#f85149')
                .style('font-size', '11px')
                .text('INBOUND ←');
            
            svg.append('text')
                .attr('x', -10)
                .attr('y', yChronology)
                .attr('text-anchor', 'end')
                .attr('dominant-baseline', 'middle')
                .style('fill', '#8b949e')
                .style('font-size', '11px')
                .text('CHRONOLOGY');
        
        // Tooltip
        const tooltip = d3.select('#tooltip');
        
            // Draw events
            console.log('Drawing', allEvents.length, 'events');
            console.log('Event types:', {
                outbound: allEvents.filter(d => d.type === 'outbound').length,
                inbound: allEvents.filter(d => d.type === 'inbound').length,
                chronology: allEvents.filter(d => d.type === 'chronology').length
            });
            
            window.nodes = svg.selectAll('.event-node')
                .data(allEvents)
                .enter()
                .append('circle')
                .attr('class', d => `event-node ${d.type}`)
                .attr('cx', d => {
                    const x = xScale(d.date);
                    if (d.type === 'chronology' && Math.random() < 0.01) {
                        console.log('Chronology event position:', d.title, 'date:', d.date, 'x:', x);
                    }
                    return x;
                })
                .attr('cy', d => {
                    if (d.type === 'outbound') return yOutbound;
                    if (d.type === 'inbound') return yInbound;
                    return yChronology;
                })
                .attr('r', d => d.type === 'chronology' ? 3 : 6)
            .on('mouseover', function(event, d) {
                tooltip.select('.tooltip-title').text(d.title);
                // Format date with BCE/CE handling
                const year = d.date.getFullYear();
                let dateStr;
                if (year < 1000) {
                    dateStr = `${1000 - year} BCE`;
                } else if (year >= 1000 && year < 2000) {
                    dateStr = `${year - 1000} CE`;
                } else {
                    dateStr = d3.timeFormat('%B %d, %Y')(d.date);
                }
                tooltip.select('.tooltip-date').text(dateStr);
                tooltip.select('.tooltip-description').text(d.description);
                tooltip.classed('visible', true);
            })
            .on('mousemove', function(event) {
                tooltip
                    .style('left', (event.pageX + 15) + 'px')
                    .style('top', (event.pageY - 15) + 'px');
            })
            .on('mouseout', function() {
                tooltip.classed('visible', false);
            });
        
        // Add year labels for key communication events only (not chronology to avoid clutter)
        const communicationEventsOnly = allEvents.filter(d => d.type === 'outbound' || d.type === 'inbound');
        svg.selectAll('.event-label')
            .data(communicationEventsOnly)
            .enter()
            .append('text')
            .attr('class', 'event-label')
            .attr('x', d => xScale(d.date))
            .attr('y', d => (d.type === 'outbound' ? yOutbound : yInbound) - 15)
            .attr('text-anchor', 'middle')
            .text(d => d3.timeFormat('%Y')(d.date));
        
            // Store references for filtering
            window.xScale = xScale;
            window.xAxis = xAxis;
            window.svg = svg;
            
            // Apply initial period filters (default to 1900+)
            applyPeriodFilters();
        }
        
        // Filter functions
        let currentFilter = 'all';
        
        function showAll() {
            currentFilter = 'all';
            updateButtons();
            applyPeriodFilters();
        }
        
        function showOutbound() {
            currentFilter = 'outbound';
            updateButtons();
            applyPeriodFilters();
        }
        
        function showInbound() {
            currentFilter = 'inbound';
            updateButtons();
            applyPeriodFilters();
        }
        
        function showChronology() {
            currentFilter = 'chronology';
            updateButtons();
            applyPeriodFilters();
        }
        
        function getEventPeriod(date) {
            const year = date.getFullYear();
            
            // Ancient: BCE to 999 CE (mapped to years 1-1999)
            if (year < 2000) return 'ancient';
            
            // Return the year as a string for exact matching
            return year.toString();
        }
        
        function matchesPeriodFilter(eventYear, filterValue) {
            // Ancient filter
            if (filterValue === 'ancient') {
                return eventYear < 2000;
            }
            
            // Exact year match (2010-2025)
            if (filterValue.length === 4) {
                return eventYear.toString() === filterValue;
            }
            
            // Decade match (194, 195, 196, 197, 198, 199, 200)
            if (filterValue.length === 3) {
                return eventYear.toString().startsWith(filterValue);
            }
            
            // Century match (18)
            if (filterValue.length === 2) {
                return eventYear.toString().startsWith(filterValue);
            }
            
            return false;
        }
        
        function applyPeriodFilters() {
            if (!window.nodes) return;
            
            // Get selected periods
            const selectedPeriods = Array.from(document.querySelectorAll('.period-filter:checked'))
                .map(cb => cb.value);
            
            // Track visible events for date range calculation
            const visibleEvents = [];
            
            // Apply filters based on current view mode
            window.nodes.each(function(d) {
                const node = d3.select(this);
                let shouldShow = false;
                
                if (currentFilter === 'all') {
                    // Show all events, but filter chronology by period
                    if (d.type === 'chronology') {
                        const eventYear = d.date.getFullYear();
                        shouldShow = selectedPeriods.some(p => matchesPeriodFilter(eventYear, p));
                    } else {
                        shouldShow = true; // Always show communication events
                    }
                } else if (currentFilter === 'outbound') {
                    shouldShow = d.type === 'outbound';
                } else if (currentFilter === 'inbound') {
                    shouldShow = d.type === 'inbound';
                } else if (currentFilter === 'chronology') {
                    // Show chronology events that match selected periods
                    if (d.type === 'chronology') {
                        const eventYear = d.date.getFullYear();
                        shouldShow = selectedPeriods.some(p => matchesPeriodFilter(eventYear, p));
                    }
                }
                
                node.style('display', shouldShow ? 'block' : 'none');
                if (shouldShow) {
                    visibleEvents.push(d);
                }
            });
            
            // Update date range based on visible events
            if (visibleEvents.length > 0 && window.xScale && window.xAxis && window.svg) {
                const dates = visibleEvents.map(d => d.date);
                const minDate = d3.min(dates);
                const maxDate = d3.max(dates);
                
                // Add padding
                const dateRange = maxDate - minDate;
                const paddedMin = new Date(minDate.getTime() - dateRange * 0.05);
                const paddedMax = new Date(maxDate.getTime() + dateRange * 0.05);
                
                // Update scale domain
                window.xScale.domain([paddedMin, paddedMax]);
                
                // Redraw axis and reposition nodes
                window.svg.select('.x-axis')
                    .transition()
                    .duration(500)
                    .call(window.xAxis);
                
                window.nodes
                    .transition()
                    .duration(500)
                    .attr('cx', d => window.xScale(d.date));
                
                window.svg.selectAll('.event-label')
                    .transition()
                    .duration(500)
                    .attr('x', d => window.xScale(d.date));
            }
        }
        
        function selectAllPeriods() {
            document.querySelectorAll('.period-filter').forEach(cb => cb.checked = true);
            applyPeriodFilters();
        }
        
        function deselectAllPeriods() {
            document.querySelectorAll('.period-filter').forEach(cb => cb.checked = false);
            applyPeriodFilters();
        }
        
        function resetZoom() {
            if (allEvents.length === 0) return;
            const dates = allEvents.map(d => d.date);
            const minDate = d3.min(dates);
            const maxDate = d3.max(dates);
            
            // Add padding
            const dateRange = maxDate - minDate;
            const paddedMin = new Date(minDate.getTime() - dateRange * 0.05);
            const paddedMax = new Date(maxDate.getTime() + dateRange * 0.05);
            
            if (window.xScale) {
                window.xScale.domain([paddedMin, paddedMax]);
                updateTimeline();
            }
        }
        
        function updateButtons() {
            d3.selectAll('.btn').classed('active', false);
            if (currentFilter === 'all') {
                d3.selectAll('.btn').filter(function() { return this.textContent === 'ALL EVENTS'; }).classed('active', true);
            } else if (currentFilter === 'outbound') {
                d3.selectAll('.btn').filter(function() { return this.textContent === 'OUTBOUND ONLY'; }).classed('active', true);
            } else if (currentFilter === 'inbound') {
                d3.selectAll('.btn').filter(function() { return this.textContent === 'INBOUND ONLY'; }).classed('active', true);
            } else if (currentFilter === 'chronology') {
                d3.selectAll('.btn').filter(function() { return this.textContent === 'CHRONOLOGY'; }).classed('active', true);
            }
        }
        
        function updateTimeline() {
            if (window.svg && window.xAxis && window.xScale && window.nodes) {
                window.svg.select('.x-axis').call(window.xAxis);
                window.nodes.attr('cx', d => window.xScale(d.date));
                window.svg.selectAll('.event-label').attr('x', d => window.xScale(d.date));
            }
        }
    </script>
</body>
</html>

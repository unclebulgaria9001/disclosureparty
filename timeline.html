<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UAP/UFO/NHI Chronology Timeline | Disclosure Database</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Interactive timeline visualization of UAP/UFO sightings, NHI encounters, and Earth's communication attempts with non-human intelligence">
    <meta name="keywords" content="UAP timeline, NHI communication, Arecibo message, crop circles, interstellar messages, UFO Êó∂Èó¥Á∫ø, Â§ñÊòü‰∫∫Êé•Ëß¶, l√≠nea de tiempo OVNI, encuentros extraterrestres, ÿ¨ÿØŸàŸÑ ÿ≤ŸÖŸÜŸä UFO, ŸÑŸÇÿßÿ°ÿßÿ™ ÿÆÿßÿ±ÿ¨ ŸÉŸàŸÉÿ® ÿßŸÑÿ£ÿ±ÿ∂, linha do tempo OVNI, encontros extraterrestres">
    <meta name="robots" content="index, follow">
    
    <!-- Multilingual hreflang tags -->
    <link rel="alternate" hreflang="en" href="https://unclebulgaria9001.github.io/disclosureparty/timeline.html">
    <link rel="alternate" hreflang="zh" href="https://unclebulgaria9001.github.io/disclosureparty/timeline.html">
    <link rel="alternate" hreflang="es" href="https://unclebulgaria9001.github.io/disclosureparty/timeline.html">
    <link rel="alternate" hreflang="ar" href="https://unclebulgaria9001.github.io/disclosureparty/timeline.html">
    <link rel="alternate" hreflang="pt" href="https://unclebulgaria9001.github.io/disclosureparty/timeline.html">
    <link rel="alternate" hreflang="x-default" href="https://unclebulgaria9001.github.io/disclosureparty/timeline.html">
    
    <!-- PWA -->
    <link rel="manifest" href="manifest.json?v=20260103">
    <meta name="theme-color" content="#58a6ff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Disclosure DB">
    
    <script src="https://d3js.org/d3.v7.min.js?v=20260103"></script>
    <link rel="stylesheet" href="i18n/language-switcher.css">
    <script src="i18n/translations.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Share Tech Mono', 'Courier New', monospace;
            background: #0d1117;
            color: #c9d1d9;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 100%;
            padding: 0;
        }
        
        header {
            text-align: center;
            padding: 30px 20px;
            background: linear-gradient(180deg, #161b22 0%, #0d1117 100%);
            border-bottom: 1px solid #30363d;
        }
        
        h1 {
            color: #58a6ff;
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #8b949e;
            font-size: 0.9em;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 20px;
            flex-wrap: wrap;
        }
        
        .tabs {
            display: flex;
            gap: 5px;
            padding: 10px 20px;
            background: #161b22;
            border-bottom: 1px solid #30363d;
            overflow-x: auto;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .tab {
            background: #21262d;
            border: 1px solid #30363d;
            color: #8b949e;
            padding: 10px 20px;
            cursor: pointer;
            font-family: 'Share Tech Mono', monospace;
            transition: all 0.2s ease;
            border-radius: 6px;
            font-size: 0.85em;
            white-space: nowrap;
        }
        
        .tab:hover {
            background: #30363d;
            border-color: #58a6ff;
            color: #58a6ff;
        }
        
        .tab.active {
            background: #1f6feb;
            border-color: #1f6feb;
            color: #ffffff;
        }
        
        .btn {
            background: #21262d;
            border: 1px solid #30363d;
            color: #8b949e;
            padding: 8px 16px;
            cursor: pointer;
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.85em;
            border-radius: 6px;
            transition: all 0.2s;
        }
        
        .btn:hover {
            background: #30363d;
            border-color: #58a6ff;
            color: #58a6ff;
        }
        
        .btn.active {
            background: #1f6feb;
            border-color: #1f6feb;
            color: #ffffff;
        }
        
        .main-layout {
            display: flex;
            min-height: calc(100vh - 200px);
        }
        
        .sidebar {
            width: 320px;
            background: #161b22;
            border-right: 1px solid #30363d;
            overflow-y: auto;
            transition: margin-left 0.3s ease;
            position: relative;
        }
        
        .sidebar.collapsed {
            margin-left: -320px;
        }
        
        .sidebar-content {
            padding: 20px;
        }
        
        .toggle-sidebar {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #21262d;
            border: 1px solid #30363d;
            color: #8b949e;
            padding: 10px 20px;
            cursor: pointer;
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.85em;
            border-radius: 6px;
            transition: all 0.3s ease;
            z-index: 1000;
            box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
            font-weight: 600;
        }
        
        .toggle-sidebar:hover {
            background: #30363d;
            border-color: #58a6ff;
            color: #58a6ff;
        }
        
        .toggle-sidebar::before {
            content: '‚ò∞ ';
            font-size: 1.2em;
        }
        
        .timeline-container {
            flex: 1;
            padding: 20px;
            overflow-x: auto;
        }
        
        #timeline {
            width: 100%;
            min-height: 800px;
            background: #0d1117;
            position: relative;
        }
        
        .timeline-axis {
            stroke: #30363d;
            stroke-width: 2;
        }
        
        .timeline-track {
            stroke: #21262d;
            stroke-width: 1;
            fill: none;
        }
        
        .event-node {
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .event-node.outbound {
            fill: #58a6ff;
            stroke: #1f6feb;
            stroke-width: 2.5;
        }
        
        .event-node.inbound {
            fill: #f85149;
            stroke: #da3633;
            stroke-width: 2.5;
        }
        
        .event-node.chronology {
            fill: #8b949e;
            stroke: #6e7681;
            stroke-width: 1.5;
        }
        
        .event-node.contact-attempt {
            fill: #a371f7;
            stroke: #8957e5;
            stroke-width: 2.5;
        }
        
        .event-node:focus {
            outline: 3px solid #ffffff;
            outline-offset: 2px;
        }
        
        .event-node:hover {
            filter: brightness(1.2);
            stroke-width: 3;
        }
        
        .event-node:hover {
            r: 10;
            filter: brightness(1.3);
        }
        
        .event-label {
            font-size: 11px;
            fill: #8b949e;
            pointer-events: none;
        }
        
        .tooltip {
            position: absolute;
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            max-width: 300px;
            z-index: 1000;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
        }
        
        .tooltip.visible {
            opacity: 1;
        }
        
        .tooltip-title {
            color: #58a6ff;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .tooltip-date {
            color: #8b949e;
            font-size: 0.85em;
            margin-bottom: 8px;
        }
        
        .tooltip-description {
            color: #c9d1d9;
            font-size: 0.85em;
            line-height: 1.4;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            padding: 20px;
            font-size: 0.9em;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .legend-dot.outbound {
            background: #58a6ff;
        }
        
        .legend-dot.inbound {
            background: #f85149;
        }
        
        .legend-dot.contact-attempt {
            background: #a371f7;
        }
        
        input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
            accent-color: #1f6feb;
        }
        
        .back-link {
            text-align: center;
            padding: 20px;
        }
        
        .back-link a {
            color: #58a6ff;
            text-decoration: none;
            font-size: 0.9em;
        }
        
        .back-link a:hover {
            text-decoration: underline;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .modal.visible {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-content {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 8px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            padding: 30px;
        }
        
        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #21262d;
            border: 1px solid #30363d;
            color: #c9d1d9;
            width: 32px;
            height: 32px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .modal-close:hover {
            background: #30363d;
            border-color: #58a6ff;
            color: #58a6ff;
        }
        
        .modal-title {
            color: #58a6ff;
            font-size: 1.3em;
            margin-bottom: 15px;
            padding-right: 40px;
        }
        
        .modal-date {
            color: #8b949e;
            font-size: 0.9em;
            margin-bottom: 20px;
        }
        
        .modal-body {
            color: #c9d1d9;
            line-height: 1.6;
        }
        
        .modal-body img {
            max-width: 100%;
            height: auto;
            margin: 15px 0;
            border-radius: 6px;
            border: 1px solid #30363d;
        }
        
        .modal-links {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #30363d;
        }
        
        .modal-links a {
            color: #58a6ff;
            text-decoration: none;
            display: block;
            margin: 5px 0;
            word-break: break-all;
        }
        
        .modal-links a:hover {
            text-decoration: underline;
        }
        
        .modal-tags {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .modal-tag {
            background: #21262d;
            border: 1px solid #30363d;
            color: #8b949e;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.85em;
        }
        
        .filter-section {
            margin-bottom: 25px;
        }
        
        .filter-section-title {
            color: #58a6ff;
            font-weight: 600;
            margin-bottom: 12px;
            font-size: 0.95em;
        }
        
        .filter-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .filter-buttons .btn {
            width: 100%;
            text-align: left;
        }
        
        .period-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            font-size: 0.85em;
        }
        
        .period-label {
            display: flex;
            align-items: center;
            gap: 6px;
            color: #c9d1d9;
            cursor: pointer;
        }
        
        .period-label:hover {
            color: #58a6ff;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 1.5em;
            }
            
            .main-layout {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #30363d;
            }
            
            .sidebar.collapsed {
                margin-left: 0;
                margin-top: -100%;
            }
            
            .toggle-sidebar {
                top: 10px;
                right: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1 data-i18n="siteTitle">UAP/UFO/NHI DISCLOSURE DATABASE</h1>
            <div class="subtitle" data-i18n="timelineSubtitle">Interactive Timeline Visualization</div>
            <button id="installBtn" class="btn" onclick="installApp()" style="display: none; margin: 10px auto;" data-i18n="installApp">üì± Install App</button>
        </header>
        
        <div class="tabs" style="display: flex; justify-content: center; gap: 10px; padding: 20px; flex-wrap: wrap; background: #161b22; border-bottom: 1px solid #30363d;">
            <div class="tab" onclick="window.location.href='viewer.html'" data-i18n="index">INDEX</div>
            <div class="tab" onclick="window.location.href='viewer.html#chronology'" data-i18n="chronology">CHRONOLOGY</div>
            <div class="tab" onclick="window.location.href='viewer.html#contact'" data-i18n="requestContact">REQUEST NHI CONTACT</div>
            <div class="tab" onclick="window.location.href='viewer.html#outbound'" data-i18n="outbound">OUTBOUND</div>
            <div class="tab" onclick="window.location.href='viewer.html#inbound'" data-i18n="inbound">INBOUND</div>
            <div class="tab" onclick="window.location.href='viewer.html#arecibo'" data-i18n="arecibo">ARECIBO 1974</div>
            <div class="tab active" data-i18n="timelineViz">TIMELINE VIZ</div>
        </div>
        
        <div id="languageSwitcherContainer"></div>
        <button class="toggle-sidebar" id="toggleSidebar" onclick="toggleSidebar(event)" data-i18n="filters">FILTERS</button>
        
        <div class="main-layout">
            <div class="sidebar" id="sidebar">
                <div class="sidebar-content">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="color: #8b949e; font-size: 0.85em; margin-bottom: 10px;">
                            <span id="eventCount">Loading events...</span>
                        </div>
                    </div>
                    
                    <div class="filter-section">
                        <div class="filter-section-title" data-i18n="eventTypeFilters">EVENT TYPE FILTERS</div>
                        <div class="filter-buttons">
                            <button class="btn active" onclick="showAll()" data-i18n="allEvents">ALL EVENTS</button>
                            <button class="btn" onclick="showCommunications()" data-i18n="inboundOutbound">INBOUND & OUTBOUND</button>
                            <button class="btn" onclick="showOutbound()" data-i18n="outboundOnly">OUTBOUND ONLY</button>
                            <button class="btn" onclick="showInbound()" data-i18n="inboundOnly">INBOUND ONLY</button>
                            <button class="btn" onclick="showContactAttempts()" data-i18n="contactAttempts">CONTACT ATTEMPTS</button>
                            <button class="btn" onclick="showChronology()" data-i18n="chronology">CHRONOLOGY</button>
                            <button class="btn" onclick="resetZoom()" data-i18n="resetZoom">RESET ZOOM</button>
                        </div>
                    </div>
                    
                    <div class="filter-section">
                        <div class="filter-section-title" data-i18n="timePeriodFilters">TIME PERIOD FILTERS</div>
                        <div class="period-grid">
                            <label class="period-label">
                                <input type="checkbox" class="period-filter" value="2030" checked onchange="applyPeriodFilters()">
                                <span>2030</span>
                            </label>
                            <label class="period-label">
                                <input type="checkbox" class="period-filter" value="2029" checked onchange="applyPeriodFilters()">
                                <span>2029</span>
                            </label>
                            <label class="period-label">
                                <input type="checkbox" class="period-filter" value="2028" checked onchange="applyPeriodFilters()">
                                <span>2028</span>
                            </label>
                            <label class="period-label">
                                <input type="checkbox" class="period-filter" value="2027" checked onchange="applyPeriodFilters()">
                                <span>2027</span>
                            </label>
                            <label class="period-label">
                                <input type="checkbox" class="period-filter" value="2026" checked onchange="applyPeriodFilters()">
                                <span>2026</span>
                            </label>
                            <label class="period-label">
                                <input type="checkbox" class="period-filter" value="2025" checked onchange="applyPeriodFilters()">
                                <span>2025</span>
                            </label>
                            <label class="period-label">
                                <input type="checkbox" class="period-filter" value="2024" checked onchange="applyPeriodFilters()">
                                <span>2024</span>
                            </label>
                            <label class="period-label">
                                <input type="checkbox" class="period-filter" value="2023" checked onchange="applyPeriodFilters()">
                                <span>2023</span>
                            </label>
                            <label class="period-label">
                                <input type="checkbox" class="period-filter" value="2022" checked onchange="applyPeriodFilters()">
                                <span>2022</span>
                            </label>
                            <label class="period-label">
                                <input type="checkbox" class="period-filter" value="2021" checked onchange="applyPeriodFilters()">
                                <span>2021</span>
                            </label>
                            <label class="period-label">
                                <input type="checkbox" class="period-filter" value="2020" checked onchange="applyPeriodFilters()">
                                <span>2020</span>
                            </label>
                            <label class="period-label">
                                <input type="checkbox" class="period-filter" value="2019" checked onchange="applyPeriodFilters()">
                                <span>2019</span>
                            </label>
                            <label class="period-label">
                                <input type="checkbox" class="period-filter" value="2018" checked onchange="applyPeriodFilters()">
                                <span>2018</span>
                            </label>
                            <label class="period-label">
                                <input type="checkbox" class="period-filter" value="2017" checked onchange="applyPeriodFilters()">
                                <span>2017</span>
                            </label>
                            <label class="period-label">
                                <input type="checkbox" class="period-filter" value="2016" checked onchange="applyPeriodFilters()">
                                <span>2016</span>
                            </label>
                            <label class="period-label">
                                <input type="checkbox" class="period-filter" value="2015" checked onchange="applyPeriodFilters()">
                                <span>2015</span>
                            </label>
                            <label class="period-label">
                                <input type="checkbox" class="period-filter" value="2014" checked onchange="applyPeriodFilters()">
                                <span>2014</span>
                            </label>
                            <label class="period-label">
                                <input type="checkbox" class="period-filter" value="2013" checked onchange="applyPeriodFilters()">
                                <span>2013</span>
                            </label>
                            <label class="period-label">
                                <input type="checkbox" class="period-filter" value="2012" checked onchange="applyPeriodFilters()">
                                <span>2012</span>
                            </label>
                            <label class="period-label">
                                <input type="checkbox" class="period-filter" value="2011" checked onchange="applyPeriodFilters()">
                                <span>2011</span>
                            </label>
                            <label class="period-label">
                                <input type="checkbox" class="period-filter" value="2010" checked onchange="applyPeriodFilters()">
                                <span>2010</span>
                            </label>
                            <label class="period-label">
                                <input type="checkbox" class="period-filter" value="200" checked onchange="applyPeriodFilters()">
                                <span>2000s</span>
                            </label>
                            <label class="period-label">
                                <input type="checkbox" class="period-filter" value="199" checked onchange="applyPeriodFilters()">
                                <span>1990s</span>
                            </label>
                            <label class="period-label">
                                <input type="checkbox" class="period-filter" value="198" checked onchange="applyPeriodFilters()">
                                <span>1980s</span>
                            </label>
                            <label class="period-label">
                                <input type="checkbox" class="period-filter" value="197" checked onchange="applyPeriodFilters()">
                                <span>1970s</span>
                            </label>
                            <label class="period-label">
                                <input type="checkbox" class="period-filter" value="196" checked onchange="applyPeriodFilters()">
                                <span>1960s</span>
                            </label>
                            <label class="period-label">
                                <input type="checkbox" class="period-filter" value="195" checked onchange="applyPeriodFilters()">
                                <span>1950s</span>
                            </label>
                            <label class="period-label">
                                <input type="checkbox" class="period-filter" value="194" checked onchange="applyPeriodFilters()">
                                <span>1940s</span>
                            </label>
                            <label class="period-label">
                                <input type="checkbox" class="period-filter" value="18" onchange="applyPeriodFilters()">
                                <span>1800s</span>
                            </label>
                            <label class="period-label">
                                <input type="checkbox" class="period-filter" value="ancient" onchange="applyPeriodFilters()">
                                <span>ANCIENT</span>
                            </label>
                        </div>
                        <div style="display: flex; gap: 8px; margin-top: 12px;">
                            <button class="btn" style="flex: 1;" onclick="selectAllPeriods()" data-i18n="selectAll">ALL</button>
                            <button class="btn" style="flex: 1;" onclick="deselectAllPeriods()" data-i18n="deselectAll">NONE</button>
                        </div>
                    </div>
                    
                    <div class="filter-section">
                        <div class="filter-section-title" data-i18n="legend">LEGEND</div>
                        <div style="display: flex; flex-direction: column; gap: 10px; font-size: 0.85em;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <svg width="16" height="16">
                                    <rect x="2" y="2" width="12" height="12" fill="#58a6ff" stroke="#1f6feb" stroke-width="2"/>
                                </svg>
                                <span data-i18n="outboundLegend">Outbound</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <svg width="16" height="16">
                                    <polygon points="8,2 14,14 2,14" fill="#f85149" stroke="#da3633" stroke-width="2"/>
                                </svg>
                                <span data-i18n="inboundLegend">Inbound</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <svg width="16" height="16">
                                    <polygon points="8,2 14,8 8,14 2,8" fill="#a371f7" stroke="#8957e5" stroke-width="2"/>
                                </svg>
                                <span data-i18n="contactLegend">Contact</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <svg width="16" height="16">
                                    <circle cx="8" cy="8" r="4" fill="#8b949e" stroke="#6e7681" stroke-width="1.5"/>
                                </svg>
                                <span data-i18n="otherLegend">Other</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid #30363d;">
                        <a href="viewer.html" style="color: #58a6ff; text-decoration: none; font-size: 0.85em;" data-i18n="backToViewer">‚Üê Back to Main Viewer</a>
                    </div>
                </div>
            </div>
            
            <div class="timeline-container">
                <div style="text-align: center; padding: 20px 0;">
                    <h2 style="color: #58a6ff; margin-bottom: 10px;" data-i18n="chronologyTitle">UAP/UFO/NHI CHRONOLOGY TIMELINE</h2>
                    <div style="color: #8b949e; font-size: 0.9em;">Interactive visualization of sightings, encounters, communications, and disclosure events</div>
                </div>
                <div id="timeline" role="application" aria-label="Interactive timeline of UAP and communication events"></div>
            </div>
        </div>
    </div>
    
    <div class="tooltip" id="tooltip">
        <div class="tooltip-title"></div>
        <div class="tooltip-date"></div>
        <div class="tooltip-description"></div>
    </div>
    
    <div class="modal" id="eventModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">√ó</button>
            <div class="modal-title" id="modalTitle"></div>
            <div class="modal-date" id="modalDate"></div>
            <div class="modal-body" id="modalBody"></div>
            <div class="modal-links" id="modalLinks"></div>
            <div class="modal-tags" id="modalTags"></div>
        </div>
    </div>
    
    <script>
        // All events (will be populated from chronology + communication events)
        let allEvents = [];
        
        // Communication events data
        const communicationEvents = [
            // Outbound Communications
            {
                date: new Date(1972, 2, 2),
                originalDateStr: '1972',
                type: 'outbound',
                title: 'Pioneer 10 Plaque',
                description: 'First physical message from humanity. Gold-anodized aluminum plaque with human figures and Earth\'s location.'
            },
            {
                date: new Date(1973, 2, 3),
                type: 'outbound',
                title: 'Pioneer 11 Plaque',
                description: 'Identical plaque to Pioneer 10, continuing humanity\'s first physical messages to space.'
            },
            {
                date: new Date(1974, 10, 16),
                type: 'outbound',
                title: 'Arecibo Message',
                description: 'First deliberate interstellar radio message. 1,679-bit signal sent to M13 cluster 25,000 light years away.'
            },
            {
                date: new Date(1977, 7, 20),
                type: 'outbound',
                title: 'Voyager Golden Records',
                description: '12-inch gold-plated records with 116 images, greetings in 55 languages, and 90 minutes of music.'
            },
            {
                date: new Date(1999, 4, 24),
                type: 'outbound',
                title: 'Cosmic Call',
                description: 'Radio message using sophisticated "Lexicon" mathematical language toward nearby stars.'
            },
            {
                date: new Date(2001, 8, 3),
                type: 'outbound',
                title: 'Teen Age Message',
                description: 'First interstellar message composed by teenagers, transmitted to six sun-like stars.'
            },
            {
                date: new Date(2003, 6, 6),
                type: 'outbound',
                title: 'Cosmic Call 2',
                description: 'Second Cosmic Call transmission to five additional stars.'
            },
            {
                date: new Date(2008, 7, 28),
                type: 'outbound',
                title: 'Hello from Earth',
                description: 'First crowdsourced message via Bebo. 501 messages from 195 countries to Gliese 581c.'
            },
            {
                date: new Date(2026, 0, 1),
                type: 'outbound',
                title: 'Request Direct NHI Communication',
                description: 'Public message requesting direct, transparent communication, bypassing government intermediaries.'
            },
            
            // Inbound Communications
            {
                date: new Date(1977, 7, 15),
                type: 'inbound',
                title: 'Wow! Signal',
                description: 'Strong 72-second narrowband radio signal from Sagittarius. Never detected again despite follow-ups.'
            },
            {
                date: new Date(2001, 7, 14),
                type: 'inbound',
                title: 'Chilbolton Face Formation',
                description: 'Crop formation showing humanoid face near Chilbolton radio telescope, Hampshire, UK.'
            },
            {
                date: new Date(2001, 7, 19),
                type: 'inbound',
                title: 'Chilbolton Arecibo Reply',
                description: 'Crop formation mirroring 1974 Arecibo message structure with different data: silicon-based DNA, different population.'
            },
            {
                date: new Date(2002, 7, 15),
                type: 'inbound',
                title: 'Crabwood Formation',
                description: 'Crop formation with alien face and binary message: "Beware the bearers of false gifts... Conduit closing."'
            },
            
            // Contact Attempts (In-Person)
            {
                date: new Date(1994, 3, 16),
                originalDateStr: '1994, April 16',
                type: 'contact-attempt',
                title: 'Ariel School, Zimbabwe',
                description: '62 pupils (ages 5-12) witnessed silvery cigar-shaped craft hover above playground. Many described receiving non-verbal "thought message" about caring for Earth. Investigated by Dr. John Mack and Cynthia Hind.'
            },
            {
                date: new Date(1996, 8, 10),
                originalDateStr: '1996, September 10',
                type: 'contact-attempt',
                title: 'Matanzas Rural School, Cuba',
                description: 'Dozens of children witnessed large glowing oval craft silently over assembly area. Pupils reported lights swept toward them in patterned sequence, as if trying to communicate.'
            },
            {
                date: new Date(1996, 0, 1),
                originalDateStr: '1996',
                type: 'contact-attempt',
                title: 'Varginha, Brazil',
                description: 'Multiple townspeople reported humanoid "grey" beings and nearby craft. One of Latin America\'s highest-profile mass-contact claims with physical evidence reports.'
            }
        ];
        
        // Load chronology data
        async function loadChronology() {
            try {
                const response = await fetch('dist/chronology.md');
                const text = await response.text();
                parseChronologyEvents(text);
            } catch (error) {
                console.error('Error loading chronology:', error);
                allEvents = [...communicationEvents];
                initializeTimeline();
            }
        }
        
        function parseChronologyEvents(text) {
            const lines = text.split('\n');
            const chronologyEvents = [];
            
            for (let line of lines) {
                line = line.trim();
                
                // Match headers like "## 2025, September 9 - Title" or "## 70 CE - Title"
                const headerMatch = line.match(/^##\s+(\d{1,4}(?:\s+(?:BCE|CE))?(?:,\s+[A-Za-z]+(?:\s+\d{1,2})?)?)\s+-\s+(.+)/i);
                
                if (headerMatch) {
                    const dateStr = headerMatch[1];
                    const title = headerMatch[2];
                    
                    // Parse date
                    const date = parseDateString(dateStr);
                    if (date) {
                        // Exclude ancient (BCE/CE) and pre-1900 events
                        const year = date.getFullYear();
                        if (year >= 1900) {
                            chronologyEvents.push({
                                date: date,
                                originalDateStr: dateStr,
                                type: 'chronology',
                                title: title,
                                description: `UAP/UFO event from chronology: ${title}`
                            });
                        }
                    }
                }
            }
            
            // Combine communication events and chronology events
            allEvents = [...communicationEvents, ...chronologyEvents];
            allEvents.sort((a, b) => a.date - b.date);
            
            // Debug: Log sample events
            console.log('Total events:', allEvents.length);
            console.log('Communication events:', communicationEvents.length);
            console.log('Chronology events:', chronologyEvents.length);
            console.log('Sample chronology events:', chronologyEvents.slice(0, 5));
            console.log('Date range:', {
                min: d3.min(allEvents.map(d => d.date)),
                max: d3.max(allEvents.map(d => d.date))
            });
            
            document.getElementById('eventCount').textContent = 
                `Showing ${allEvents.length} events (${communicationEvents.length} communications, ${chronologyEvents.length} chronology)`;
            
            initializeTimeline();
        }
        
        function parseDateString(dateStr) {
            // Handle BCE/CE dates - JavaScript Date doesn't support BCE, so use year 1 as baseline
            const bceMatch = dateStr.match(/^(\d+)\s+BCE/i);
            if (bceMatch) {
                const year = parseInt(bceMatch[1]);
                // Map BCE to early dates: 1000 BCE = year 1, 1 BCE = year 1000
                return new Date(1000 - year, 0, 1);
            }
            
            const ceMatch = dateStr.match(/^(\d+)\s+CE/i);
            if (ceMatch) {
                const year = parseInt(ceMatch[1]);
                // Map CE 1-1000 to years 1000-2000 to avoid overlap with modern dates
                if (year < 1000) {
                    return new Date(1000 + year, 0, 1);
                }
                return new Date(year, 0, 1);
            }
            
            // Handle modern dates like "2025, September 9"
            const modernMatch = dateStr.match(/^(\d{4})(?:,\s+([A-Za-z]+)(?:\s+(\d{1,2}))?)?/);
            if (modernMatch) {
                const year = parseInt(modernMatch[1]);
                const monthName = modernMatch[2];
                const day = modernMatch[3] ? parseInt(modernMatch[3]) : 1;
                
                if (monthName) {
                    const months = {
                        'january': 0, 'february': 1, 'march': 2, 'april': 3,
                        'may': 4, 'june': 5, 'july': 6, 'august': 7,
                        'september': 8, 'october': 9, 'november': 10, 'december': 11
                    };
                    const month = months[monthName.toLowerCase()];
                    if (month !== undefined) {
                        return new Date(year, month, day);
                    }
                }
                
                return new Date(year, 0, 1);
            }
            
            return null;
        }
        
        // Initialize on page load
        loadChronology();
        
        function initializeTimeline() {
            if (allEvents.length === 0) return;
            
            // Clear existing SVG
            d3.select('#timeline svg').remove();
            
            drawTimeline();
        }
        
        function drawTimeline() {
            // Timeline dimensions - rotated 90 degrees
            const margin = {top: 40, right: 150, bottom: 40, left: 60};
            const width = Math.max(document.getElementById('timeline').clientWidth - margin.left - margin.right, 600);
            const height = 1200;
            
            // Create SVG
            const svg = d3.select('#timeline')
                .append('svg')
                .attr('width', width + margin.left + margin.right)
                .attr('height', height + margin.top + margin.bottom)
                .append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);
            
            // Filter to modern events only (1970+) for initial display to avoid squashing
            const modernEvents = allEvents.filter(d => d.date.getFullYear() >= 1970);
            
            // Find date range from modern events with padding
            const dates = modernEvents.map(d => d.date);
            const minDate = d3.min(dates);
            const maxDate = d3.max(dates);
            
            // Add padding to date range (5% on each side)
            const dateRange = maxDate - minDate;
            const paddedMin = new Date(minDate.getTime() - dateRange * 0.05);
            const paddedMax = new Date(maxDate.getTime() + dateRange * 0.05);
            
            // Scales - vertical timeline
            const yScale = d3.scaleTime()
                .domain([paddedMin, paddedMax])
                .range([0, height]);
            
            const xOutbound = width * 0.25;
            const xInbound = width * 0.45;
            const xContactAttempt = width * 0.65;
            const xChronology = width * 0.85;
        
            // Check if we have any truly ancient events (BCE/CE before year 1000) in the current view
            const hasAncientEvents = modernEvents.some(e => e.date.getFullYear() < 1900);
            
            // Axes with custom tick format - only show BCE/CE if ancient events exist
            const yAxis = d3.axisLeft(yScale)
                .ticks(20)
                .tickFormat(d => {
                    const year = d.getFullYear();
                    
                    // Only use BCE/CE format if we have truly ancient events (pre-1900)
                    if (hasAncientEvents && year < 1900) {
                        if (year < 1000) {
                            return `${1000 - year} BCE`;
                        } else if (year >= 1000 && year < 2000) {
                            return `${year - 1000} CE`;
                        }
                    }
                    
                    // Show modern years normally (1900+)
                    return year.toString();
                });
        
        svg.append('g')
            .attr('class', 'y-axis')
            .attr('transform', `translate(0,0)`)
            .call(yAxis)
            .selectAll('text')
            .style('fill', '#8b949e')
            .style('font-family', 'Share Tech Mono');
        
        svg.selectAll('.y-axis path, .y-axis line')
            .style('stroke', '#30363d');
        
            // Timeline tracks - vertical
            svg.append('line')
                .attr('class', 'timeline-track')
                .attr('x1', xOutbound)
                .attr('y1', 0)
                .attr('x2', xOutbound)
                .attr('y2', height);
            
            svg.append('line')
                .attr('class', 'timeline-track')
                .attr('x1', xInbound)
                .attr('y1', 0)
                .attr('x2', xInbound)
                .attr('y2', height);
            
            svg.append('line')
                .attr('class', 'timeline-track')
                .attr('x1', xContactAttempt)
                .attr('y1', 0)
                .attr('x2', xContactAttempt)
                .attr('y2', height);
            
            svg.append('line')
                .attr('class', 'timeline-track')
                .attr('x1', xChronology)
                .attr('y1', 0)
                .attr('x2', xChronology)
                .attr('y2', height);
            
            // Track labels - vertical
            svg.append('text')
                .attr('x', xOutbound)
                .attr('y', -10)
                .attr('text-anchor', 'middle')
                .attr('dominant-baseline', 'auto')
                .style('fill', '#58a6ff')
                .style('font-size', '11px')
                .text('EARTH ‚Üí SPACE');
            
            svg.append('text')
                .attr('x', xInbound)
                .attr('y', -10)
                .attr('text-anchor', 'middle')
                .attr('dominant-baseline', 'auto')
                .style('fill', '#f85149')
                .style('font-size', '11px')
                .text('SPACE ‚Üí EARTH');
            
            svg.append('text')
                .attr('x', xContactAttempt)
                .attr('y', -10)
                .attr('text-anchor', 'middle')
                .attr('dominant-baseline', 'auto')
                .style('fill', '#a371f7')
                .style('font-size', '11px')
                .text('IN-PERSON CONTACT');
            
            svg.append('text')
                .attr('x', xChronology)
                .attr('y', -10)
                .attr('text-anchor', 'middle')
                .attr('dominant-baseline', 'auto')
                .style('fill', '#8b949e')
                .style('font-size', '11px')
                .text('OTHER EVENTS');
        
        // Add visual legend on the far left
        const legendX = 20;
        const legendY = 100;
        const legendSpacing = 40;
        
        // Legend title
        svg.append('text')
            .attr('x', legendX)
            .attr('y', legendY - 20)
            .style('fill', '#58a6ff')
            .style('font-size', '12px')
            .style('font-weight', 'bold')
            .text('LEGEND');
        
        // Outbound (square)
        svg.append('rect')
            .attr('x', legendX - 6)
            .attr('y', legendY - 6)
            .attr('width', 12)
            .attr('height', 12)
            .style('fill', '#58a6ff')
            .style('stroke', '#1f6feb')
            .style('stroke-width', 2);
        svg.append('text')
            .attr('x', legendX + 20)
            .attr('y', legendY)
            .attr('dominant-baseline', 'middle')
            .style('fill', '#c9d1d9')
            .style('font-size', '10px')
            .text('Outbound');
        
        // Inbound (triangle)
        svg.append('polygon')
            .attr('points', `${legendX},${legendY + legendSpacing - 8} ${legendX + 7},${legendY + legendSpacing + 5} ${legendX - 7},${legendY + legendSpacing + 5}`)
            .style('fill', '#f85149')
            .style('stroke', '#da3633')
            .style('stroke-width', 2);
        svg.append('text')
            .attr('x', legendX + 20)
            .attr('y', legendY + legendSpacing)
            .attr('dominant-baseline', 'middle')
            .style('fill', '#c9d1d9')
            .style('font-size', '10px')
            .text('Inbound');
        
        // Contact (diamond)
        svg.append('polygon')
            .attr('points', `${legendX},${legendY + legendSpacing * 2 - 7} ${legendX + 7},${legendY + legendSpacing * 2} ${legendX},${legendY + legendSpacing * 2 + 7} ${legendX - 7},${legendY + legendSpacing * 2}`)
            .style('fill', '#a371f7')
            .style('stroke', '#8957e5')
            .style('stroke-width', 2);
        svg.append('text')
            .attr('x', legendX + 20)
            .attr('y', legendY + legendSpacing * 2)
            .attr('dominant-baseline', 'middle')
            .style('fill', '#c9d1d9')
            .style('font-size', '10px')
            .text('Contact');
        
        // Other (circle)
        svg.append('circle')
            .attr('cx', legendX)
            .attr('cy', legendY + legendSpacing * 3)
            .attr('r', 4)
            .style('fill', '#8b949e')
            .style('stroke', '#6e7681')
            .style('stroke-width', 1.5);
        svg.append('text')
            .attr('x', legendX + 20)
            .attr('y', legendY + legendSpacing * 3)
            .attr('dominant-baseline', 'middle')
            .style('fill', '#c9d1d9')
            .style('font-size', '10px')
            .text('Other');
        
        // Tooltip
        const tooltip = d3.select('#tooltip');
        
            // Draw events
            console.log('Drawing', allEvents.length, 'events');
            console.log('Event types:', {
                outbound: allEvents.filter(d => d.type === 'outbound').length,
                inbound: allEvents.filter(d => d.type === 'inbound').length,
                chronology: allEvents.filter(d => d.type === 'chronology').length
            });
            
            // Draw events with different shapes for accessibility - vertical
            const eventGroups = svg.selectAll('.event-group')
                .data(allEvents)
                .enter()
                .append('g')
                .attr('class', 'event-group')
                .attr('transform', d => {
                    const y = yScale(d.date);
                    let x;
                    if (d.type === 'outbound') x = xOutbound;
                    else if (d.type === 'inbound') x = xInbound;
                    else if (d.type === 'contact-attempt') x = xContactAttempt;
                    else x = xChronology;
                    return `translate(${x},${y})`;
                })
                .attr('role', 'button')
                .attr('tabindex', '0')
                .attr('aria-label', d => {
                    const typeLabel = d.type === 'outbound' ? 'Earth to Space message' :
                                     d.type === 'inbound' ? 'Space to Earth signal' :
                                     d.type === 'contact-attempt' ? 'In-person contact event' :
                                     'Historical event';
                    return `${d.title}, ${typeLabel}, ${d.originalDateStr || d3.timeFormat('%Y')(d.date)}`;
                });
            
            // Add different shapes based on event type
            eventGroups.each(function(d) {
                const group = d3.select(this);
                const size = d.type === 'chronology' ? 3 : 6;
                
                if (d.type === 'outbound') {
                    // Square for outbound
                    group.append('rect')
                        .attr('class', `event-node ${d.type}`)
                        .attr('x', -size)
                        .attr('y', -size)
                        .attr('width', size * 2)
                        .attr('height', size * 2);
                } else if (d.type === 'inbound') {
                    // Triangle for inbound
                    group.append('polygon')
                        .attr('class', `event-node ${d.type}`)
                        .attr('points', `0,${-size * 1.3} ${size * 1.1},${size * 0.7} ${-size * 1.1},${size * 0.7}`);
                } else if (d.type === 'contact-attempt') {
                    // Diamond for contact attempts
                    group.append('polygon')
                        .attr('class', `event-node ${d.type}`)
                        .attr('points', `0,${-size * 1.2} ${size * 1.2},0 0,${size * 1.2} ${-size * 1.2},0`);
                } else {
                    // Circle for chronology (default)
                    group.append('circle')
                        .attr('class', `event-node ${d.type}`)
                        .attr('r', size);
                }
            });
            
            window.nodes = eventGroups
            .on('mouseover', function(event, d) {
                tooltip.select('.tooltip-title').text(d.title);
                // Use original date string if available, otherwise format the date
                let dateStr;
                if (d.originalDateStr) {
                    // Check if it's a BCE/CE date
                    if (d.originalDateStr.match(/BCE|CE/i)) {
                        dateStr = d.originalDateStr;
                    } else {
                        // Modern date - parse the year from original string
                        const yearMatch = d.originalDateStr.match(/^(\d{4})/);
                        if (yearMatch) {
                            const year = yearMatch[1];
                            const monthMatch = d.originalDateStr.match(/,\s+([A-Za-z]+)(?:\s+(\d{1,2}))?/);
                            if (monthMatch) {
                                const month = monthMatch[1];
                                const day = monthMatch[2] || '1';
                                dateStr = `${month} ${day}, ${year}`;
                            } else {
                                dateStr = year;
                            }
                        } else {
                            dateStr = d.originalDateStr;
                        }
                    }
                } else {
                    // Fallback for events without originalDateStr
                    dateStr = d3.timeFormat('%B %d, %Y')(d.date);
                }
                tooltip.select('.tooltip-date').text(dateStr);
                tooltip.select('.tooltip-description').text(d.description);
                tooltip.classed('visible', true);
            })
            .on('mousemove', function(event) {
                tooltip
                    .style('left', (event.pageX + 15) + 'px')
                    .style('top', (event.pageY - 15) + 'px');
            })
            .on('mouseout', function() {
                tooltip.classed('visible', false);
            })
            .on('click', function(event, d) {
                event.stopPropagation();
                showEventModal(d);
            })
            .on('keydown', function(event, d) {
                if (event.key === 'Enter' || event.key === ' ') {
                    event.preventDefault();
                    showEventModal(d);
                }
            })
            .style('cursor', 'pointer');
        
        // Add title labels for all events - vertical
        svg.selectAll('.event-label')
            .data(allEvents)
            .enter()
            .append('text')
            .attr('class', 'event-label')
            .attr('y', d => yScale(d.date))
            .attr('x', d => {
                if (d.type === 'outbound') return xOutbound + 15;
                if (d.type === 'inbound') return xInbound + 15;
                if (d.type === 'contact-attempt') return xContactAttempt + 15;
                return xChronology + 15;
            })
            .attr('text-anchor', 'start')
            .attr('dominant-baseline', 'middle')
            .style('font-size', '10px')
            .style('fill', '#c9d1d9')
            .text(d => {
                // Truncate title to max 30 characters
                const maxLength = 30;
                const title = d.title || 'Untitled';
                return title.length > maxLength ? title.substring(0, maxLength) + '...' : title;
            })
            .style('cursor', 'pointer')
            .on('click', function(event, d) {
                event.stopPropagation();
                showEventModal(d);
            });
        
            // Store references for filtering
            window.yScale = yScale;
            window.yAxis = yAxis;
            window.svg = svg;
            
            // Apply initial period filters (default to 1900+)
            applyPeriodFilters();
        }
        
        // Filter functions
        let currentFilter = 'all';
        
        function showAll() {
            currentFilter = 'all';
            updateButtons();
            applyPeriodFilters();
        }
        
        function showOutbound() {
            currentFilter = 'outbound';
            updateButtons();
            applyPeriodFilters();
        }
        
        function showInbound() {
            currentFilter = 'inbound';
            updateButtons();
            applyPeriodFilters();
        }
        
        function showChronology() {
            currentFilter = 'chronology';
            updateButtons();
            applyPeriodFilters();
        }
        
        function showContactAttempts() {
            currentFilter = 'contact-attempt';
            updateButtons();
            applyPeriodFilters();
        }
        
        function showCommunications() {
            currentFilter = 'communications';
            updateButtons();
            applyPeriodFilters();
        }
        
        function getEventPeriod(date) {
            const year = date.getFullYear();
            
            // Ancient: BCE to 999 CE (mapped to years 1-1999)
            if (year < 2000) return 'ancient';
            
            // Return the year as a string for exact matching
            return year.toString();
        }
        
        function matchesPeriodFilter(eventYear, filterValue) {
            // Ancient filter
            if (filterValue === 'ancient') {
                return eventYear < 2000;
            }
            
            // Exact year match (2010-2025)
            if (filterValue.length === 4) {
                return eventYear.toString() === filterValue;
            }
            
            // Decade match (194, 195, 196, 197, 198, 199, 200)
            if (filterValue.length === 3) {
                return eventYear.toString().startsWith(filterValue);
            }
            
            // Century match (18)
            if (filterValue.length === 2) {
                return eventYear.toString().startsWith(filterValue);
            }
            
            return false;
        }
        
        function applyPeriodFilters() {
            if (!window.nodes) return;
            
            // Get selected periods
            const selectedPeriods = Array.from(document.querySelectorAll('.period-filter:checked'))
                .map(cb => cb.value);
            
            // Track visible events for date range calculation
            const visibleEvents = [];
            
            // Apply filters based on current view mode
            window.nodes.each(function(d) {
                const node = d3.select(this);
                let shouldShow = false;
                
                if (currentFilter === 'all') {
                    // Show all events, but filter chronology by period
                    if (d.type === 'chronology') {
                        const eventYear = d.date.getFullYear();
                        shouldShow = selectedPeriods.some(p => matchesPeriodFilter(eventYear, p));
                    } else {
                        shouldShow = true; // Always show communication and contact-attempt events
                    }
                } else if (currentFilter === 'communications') {
                    shouldShow = d.type === 'outbound' || d.type === 'inbound' || d.type === 'contact-attempt';
                } else if (currentFilter === 'outbound') {
                    shouldShow = d.type === 'outbound';
                } else if (currentFilter === 'inbound') {
                    shouldShow = d.type === 'inbound' || d.type === 'contact-attempt';
                } else if (currentFilter === 'contact-attempt') {
                    shouldShow = d.type === 'contact-attempt';
                } else if (currentFilter === 'chronology') {
                    // Show chronology events that match selected periods
                    if (d.type === 'chronology') {
                        const eventYear = d.date.getFullYear();
                        shouldShow = selectedPeriods.some(p => matchesPeriodFilter(eventYear, p));
                    }
                }
                
                node.style('display', shouldShow ? 'block' : 'none');
                if (shouldShow) {
                    visibleEvents.push(d);
                }
            });
            
            // Update date range based on visible events - vertical
            if (visibleEvents.length > 0 && window.yScale && window.yAxis && window.svg) {
                const dates = visibleEvents.map(d => d.date);
                const minDate = d3.min(dates);
                const maxDate = d3.max(dates);
                
                // Add padding
                const dateRange = maxDate - minDate;
                const paddedMin = new Date(minDate.getTime() - dateRange * 0.05);
                const paddedMax = new Date(maxDate.getTime() + dateRange * 0.05);
                
                // Update scale domain
                window.yScale.domain([paddedMin, paddedMax]);
                
                // Redraw axis and reposition nodes
                window.svg.select('.y-axis')
                    .transition()
                    .duration(500)
                    .call(window.yAxis);
                
                window.nodes
                    .transition()
                    .duration(500)
                    .attr('transform', function(d) {
                        const currentTransform = d3.select(this).attr('transform');
                        const xMatch = currentTransform.match(/translate\(([^,]+)/);
                        const x = xMatch ? xMatch[1] : 0;
                        return `translate(${x},${window.yScale(d.date)})`;
                    });
                
                window.svg.selectAll('.event-label')
                    .transition()
                    .duration(500)
                    .attr('y', d => window.yScale(d.date));
            }
        }
        
        function selectAllPeriods() {
            document.querySelectorAll('.period-filter').forEach(cb => cb.checked = true);
            applyPeriodFilters();
        }
        
        function deselectAllPeriods() {
            document.querySelectorAll('.period-filter').forEach(cb => cb.checked = false);
            applyPeriodFilters();
        }
        
        // Modal functions
        let chronologyData = null;
        
        async function loadChronologyData() {
            if (chronologyData) return chronologyData;
            
            try {
                const response = await fetch('dist/chronology.md');
                const text = await response.text();
                chronologyData = parseChronologyData(text);
                return chronologyData;
            } catch (error) {
                console.error('Error loading chronology data:', error);
                return null;
            }
        }
        
        function parseChronologyData(text) {
            const lines = text.split('\n');
            const entries = [];
            let currentEntry = null;
            
            for (let line of lines) {
                line = line.trim();
                
                const headerMatch = line.match(/^##\s+(\d{1,4}(?:\s+(?:BCE|CE))?(?:,\s+[A-Za-z]+(?:\s+\d{1,2})?)?)\s+-\s+(.+)/i);
                
                if (headerMatch) {
                    if (currentEntry) entries.push(currentEntry);
                    currentEntry = {
                        date: headerMatch[1],
                        title: headerMatch[2],
                        content: '',
                        images: [],
                        links: [],
                        tags: []
                    };
                } else if (currentEntry) {
                    // Parse images
                    if (line.startsWith('![')) {
                        const imgMatch = line.match(/!\[([^\]]*)\]\(([^)]+)\)/);
                        if (imgMatch) {
                            currentEntry.images.push(imgMatch[2]);
                        }
                    }
                    // Parse links
                    else if (line.startsWith('http://') || line.startsWith('https://')) {
                        currentEntry.links.push(line);
                    }
                    // Parse tags
                    const tags = line.match(/#[A-Za-z0-9_]+/g);
                    if (tags) currentEntry.tags.push(...tags);
                    
                    // Add to content (skip image lines, footnotes, etc)
                    if (!line.startsWith('![') && !line.startsWith('[^') && line !== '\\' && line.length > 0 && !line.startsWith('##')) {
                        // Keep markdown links intact instead of removing them
                        if (cleanLine.trim().length > 0) {
                            currentEntry.content += (currentEntry.content ? '\n' : '') + line;
                        }
                    }
                }
            }
            
            if (currentEntry) entries.push(currentEntry);
            return entries;
        }
        
        async function showEventModal(eventData) {
            const modal = document.getElementById('eventModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalDate = document.getElementById('modalDate');
            const modalBody = document.getElementById('modalBody');
            const modalLinks = document.getElementById('modalLinks');
            const modalTags = document.getElementById('modalTags');
            
            // Set basic info
            modalTitle.textContent = eventData.title;
            
            // Format date
            let dateStr;
            if (eventData.originalDateStr) {
                if (eventData.originalDateStr.match(/BCE|CE/i)) {
                    dateStr = eventData.originalDateStr;
                } else {
                    const yearMatch = eventData.originalDateStr.match(/^(\d{4})/);
                    if (yearMatch) {
                        const year = yearMatch[1];
                        const monthMatch = eventData.originalDateStr.match(/,\s+([A-Za-z]+)(?:\s+(\d{1,2}))?/);
                        if (monthMatch) {
                            const month = monthMatch[1];
                            const day = monthMatch[2] || '1';
                            dateStr = `${month} ${day}, ${year}`;
                        } else {
                            dateStr = year;
                        }
                    } else {
                        dateStr = eventData.originalDateStr;
                    }
                }
            } else {
                dateStr = d3.timeFormat('%B %d, %Y')(eventData.date);
            }
            modalDate.textContent = dateStr;
            
            // For chronology events, load full content
            if (eventData.type === 'chronology') {
                const data = await loadChronologyData();
                if (data) {
                    const entry = data.find(e => e.title === eventData.title);
                    if (entry) {
                        // Convert markdown links to HTML links
                        let content = entry.content;
                        content = content.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>');
                        content = content.replace(/\n/g, '<br>');
                        modalBody.innerHTML = content;
                        
                        // Add images
                        if (entry.images.length > 0) {
                            const imagesHtml = entry.images.map(img => 
                                `<img src="${img}" alt="" loading="lazy">`
                            ).join('');
                            modalBody.innerHTML += imagesHtml;
                        }
                        
                        // Add links
                        if (entry.links.length > 0) {
                            modalLinks.innerHTML = '<div style="color: #8b949e; margin-bottom: 10px;">Sources:</div>' +
                                entry.links.map(link => `<a href="${link}" target="_blank">${link}</a>`).join('');
                        } else {
                            modalLinks.innerHTML = '';
                        }
                        
                        // Add tags
                        if (entry.tags.length > 0) {
                            modalTags.innerHTML = entry.tags.map(tag => 
                                `<span class="modal-tag">${tag}</span>`
                            ).join('');
                        } else {
                            modalTags.innerHTML = '';
                        }
                    } else {
                        modalBody.textContent = eventData.description;
                        modalLinks.innerHTML = '';
                        modalTags.innerHTML = '';
                    }
                } else {
                    modalBody.textContent = eventData.description;
                    modalLinks.innerHTML = '';
                    modalTags.innerHTML = '';
                }
            } else {
                // Communication events
                modalBody.textContent = eventData.description;
                modalLinks.innerHTML = '';
                modalTags.innerHTML = '';
            }
            
            modal.classList.add('visible');
        }
        
        function closeModal() {
            const modal = document.getElementById('eventModal');
            modal.classList.remove('visible');
        }
        
        // Close modal when clicking outside
        document.getElementById('eventModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
        
        // Close modal with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
        });
        
        function resetZoom() {
            if (allEvents.length === 0) return;
            const dates = allEvents.map(d => d.date);
            const minDate = d3.min(dates);
            const maxDate = d3.max(dates);
            
            // Add padding
            const dateRange = maxDate - minDate;
            const paddedMin = new Date(minDate.getTime() - dateRange * 0.05);
            const paddedMax = new Date(maxDate.getTime() + dateRange * 0.05);
            
            if (window.yScale) {
                window.yScale.domain([paddedMin, paddedMax]);
                updateTimeline();
            }
        }
        
        function updateButtons() {
            d3.selectAll('.btn').classed('active', false);
            if (currentFilter === 'all') {
                d3.selectAll('.btn').filter(function() { return this.textContent === 'ALL EVENTS'; }).classed('active', true);
            } else if (currentFilter === 'outbound') {
                d3.selectAll('.btn').filter(function() { return this.textContent === 'OUTBOUND ONLY'; }).classed('active', true);
            } else if (currentFilter === 'inbound') {
                d3.selectAll('.btn').filter(function() { return this.textContent === 'INBOUND ONLY'; }).classed('active', true);
            } else if (currentFilter === 'chronology') {
                d3.selectAll('.btn').filter(function() { return this.textContent === 'CHRONOLOGY'; }).classed('active', true);
            }
        }
        
        function updateTimeline() {
            if (window.svg && window.yAxis && window.yScale && window.nodes) {
                window.svg.select('.y-axis').call(window.yAxis);
                window.nodes.attr('transform', function(d) {
                    const currentTransform = d3.select(this).attr('transform');
                    const xMatch = currentTransform.match(/translate\(([^,]+)/);
                    const x = xMatch ? xMatch[1] : 0;
                    return `translate(${x},${window.yScale(d.date)})`;
                });
                window.svg.selectAll('.event-label').attr('y', d => window.yScale(d.date));
            }
        }
        
        function toggleSidebar(event) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            const sidebar = document.getElementById('sidebar');
            const toggleBtn = document.getElementById('toggleSidebar');
            sidebar.classList.toggle('collapsed');
            toggleBtn.classList.toggle('collapsed');
            
            // Persist state
            const isCollapsed = sidebar.classList.contains('collapsed');
            localStorage.setItem('sidebarCollapsed', isCollapsed);
        }
        
        // Restore sidebar state on load
        window.addEventListener('DOMContentLoaded', function() {
            const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
            if (isCollapsed) {
                document.getElementById('sidebar').classList.add('collapsed');
                document.getElementById('toggleSidebar').classList.add('collapsed');
            }
        });
        
        // PWA Install
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            const installBtn = document.getElementById('installBtn');
            if (installBtn) {
                installBtn.style.display = 'block';
            }
        });
        
        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('App installed');
                    }
                    deferredPrompt = null;
                    const installBtn = document.getElementById('installBtn');
                    if (installBtn) {
                        installBtn.style.display = 'none';
                    }
                });
            }
        }
        
        // Register service worker with cache busting
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js?v=20260103')
                .then(reg => console.log('Service Worker registered'))
                .catch(err => console.log('Service Worker registration failed'));
        }
        
        // Initialize language switcher
        document.getElementById('languageSwitcherContainer').innerHTML = createLanguageSwitcher();
        updatePageLanguage();
    </script>
</body>
</html>
